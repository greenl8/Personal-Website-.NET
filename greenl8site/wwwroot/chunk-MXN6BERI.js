import{Vc as s}from"./chunk-AUDWPJIE.js";import"./chunk-GAL4ENT6.js";var l=class{quill;options;currentImage;overlay=null;handles;platformId;constructor(t,e={},i){this.quill=t,this.options=e,this.currentImage=null,this.handles=[],this.platformId=i||(typeof window<"u"?window.document:{}),s(this.platformId)&&(this.overlay=document.createElement("div"),this.overlay.classList.add("image-resizer"),this.overlay.style.display="none",this.addResizeHandles(),this.quill.root&&this.quill.root.parentNode&&this.quill.root.parentNode.appendChild(this.overlay),this.quill.on("selection-change",this.checkSelection.bind(this)),this.quill.root.addEventListener("click",this.checkImage.bind(this)),this.quill.root.addEventListener("scroll",()=>{this.hideOverlay()}),this.quill.root.addEventListener("blur",()=>{this.hideOverlay()}))}addResizeHandles(){if(!s(this.platformId)||!this.overlay)return;["se","ne","sw","nw"].forEach(e=>{let i=document.createElement("div");i.classList.add("resize-handle",`resize-handle-${e}`),i.addEventListener("mousedown",this.handleMousedown.bind(this,e)),this.overlay.appendChild(i),this.handles.push(i)})}checkSelection(t){if(!s(this.platformId)||!t)return;let[e,i]=this.quill.getLeaf(t.index);e&&e.domNode&&e.domNode.tagName==="IMG"?this.showOverlay(e.domNode):this.hideOverlay()}checkImage(t){if(!s(this.platformId))return;let e=t.target;e&&e.tagName==="IMG"?this.showOverlay(e):this.overlay&&e&&!this.overlay.contains(e)&&this.hideOverlay()}showOverlay(t){if(!s(this.platformId)||!this.overlay)return;this.currentImage=t;let e=t.getBoundingClientRect(),i=this.quill.root.parentNode.getBoundingClientRect();this.overlay.style.left=`${e.left-i.left}px`,this.overlay.style.top=`${e.top-i.top}px`,this.overlay.style.width=`${e.width}px`,this.overlay.style.height=`${e.height}px`,this.overlay.style.display="block"}hideOverlay(){!s(this.platformId)||!this.overlay||(this.overlay.style.display="none",this.currentImage=null)}handleMousedown(t,e){if(!s(this.platformId)||!this.currentImage)return;e.preventDefault(),e.stopPropagation();let i=e.clientX,p=e.clientY,c=this.currentImage.width,u=this.currentImage.height,r=c/u,y=!0,m=a=>{a.preventDefault();let o=a.clientX-i,n=a.clientY-p;t.includes("n")&&(n=-n),t.includes("w")&&(o=-o),y&&(Math.abs(o)>Math.abs(n*r)?n=o/r:o=n*r);let d=c+o,h=u+n;d=Math.max(30,d),h=Math.max(30,h),this.currentImage.width=d,this.currentImage.height=h,this.showOverlay(this.currentImage)},v=()=>{document.removeEventListener("mousemove",m),document.removeEventListener("mouseup",v)};document.addEventListener("mousemove",m),document.addEventListener("mouseup",v)}};typeof window<"u"&&window.Quill&&s(window.document)&&window.Quill.register("modules/imageResize",l);var g=l;export{l as ImageResize,g as default};
