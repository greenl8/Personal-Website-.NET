<div class="statistics-container">
  <!-- Header with title and controls -->
  <div class="statistics-header">
    <div class="title-section">
      <h2>
        <img src="assets/images/statistics.png" class="toolbar-img-icon">
        Statistics
      </h2>
      <div class="date-range">{{ getDateRangeLabel() }}</div>
    </div>
    
    <div class="controls-section">
      <!-- Interval selector -->
      <mat-form-field appearance="outline" class="interval-select">
        <mat-label>View by</mat-label>
        <mat-select [formControl]="intervalControl">
          <mat-option *ngFor="let interval of intervals" [value]="interval.value">
            {{ interval.label }}
          </mat-option>
        </mat-select>
      </mat-form-field>
      
      <!-- Quick date range buttons -->
      <div class="quick-ranges">
        <button mat-button (click)="setDateRange(7)" 
                [class.active]="getDateRangeLabel().includes('7')">
          Last 7 days
        </button>
        <button mat-button (click)="setDateRange(30)">Last 30 days</button>
        <button mat-button (click)="setDateRange(90)">Last 3 months</button>
      </div>
      
      <!-- Custom date range -->
      <button mat-icon-button [matMenuTriggerFor]="dateMenu" matTooltip="Custom date range">
        <img src="assets/images/dashboard.png" class="toolbar-img-icon">
      </button>
      <mat-menu #dateMenu="matMenu" class="date-menu">
        <div class="date-range-picker" (click)="$event.stopPropagation()">
          <mat-form-field appearance="outline">
            <mat-label>Start date</mat-label>
            <input matInput [matDatepicker]="startPicker" [formControl]="startDateControl">
            <mat-datepicker-toggle matSuffix [for]="startPicker"></mat-datepicker-toggle>
            <mat-datepicker #startPicker></mat-datepicker>
          </mat-form-field>
          
          <mat-form-field appearance="outline">
            <mat-label>End date</mat-label>
            <input matInput [matDatepicker]="endPicker" [formControl]="endDateControl">
            <mat-datepicker-toggle matSuffix [for]="endPicker"></mat-datepicker-toggle>
            <mat-datepicker #endPicker></mat-datepicker>
          </mat-form-field>
        </div>
      </mat-menu>
    </div>
  </div>
  
  <!-- Loading state -->
  <div *ngIf="loading" class="loading-state">
    <mat-icon>hourglass_empty</mat-icon>
    <p>Loading statistics...</p>
  </div>
  
  <!-- Error state -->
  <div *ngIf="error && !loading" class="error-state">
    <mat-icon>error</mat-icon>
    <h3>Error Loading Statistics</h3>
    <p>Unable to load statistics data. Showing demo data instead.</p>
    <button mat-button color="primary" (click)="retry()">Retry</button>
  </div>
  
  <!-- Metrics cards -->
  <div class="metrics-grid" *ngIf="!loading">
    <!-- Views -->
    <div class="metric-card">
      <div class="metric-icon views-icon">
        <img src="assets/images/views.png" alt="Views icon" class="metric-img-icon">
      </div>
      <div class="metric-content">
        <div class="metric-value">{{ viewsStats.current.toLocaleString() }}</div>
        <div class="metric-label">Views</div>
        <div class="metric-change" [class.trend-up]="viewsStats.trend === 'up'" 
             [class.trend-down]="viewsStats.trend === 'down'">
          <mat-icon>{{ viewsStats.trend === 'up' ? 'trending_up' : 'trending_down' }}</mat-icon>
          {{ viewsStats.change }}%
        </div>
      </div>
    </div>
    
    <!-- Visitors -->
    <div class="metric-card">
      <div class="metric-icon visitors-icon">
        <img src="assets/images/user.png" alt="Visitors icon" class="metric-img-icon">
      </div>
      <div class="metric-content">
        <div class="metric-value">{{ visitorsStats.current.toLocaleString() }}</div>
        <div class="metric-label">Visitors</div>
        <div class="metric-change" [class.trend-up]="visitorsStats.trend === 'up'" 
             [class.trend-down]="visitorsStats.trend === 'down'">
          <mat-icon>{{ visitorsStats.trend === 'up' ? 'trending_up' : 'trending_down' }}</mat-icon>
          {{ visitorsStats.change }}%
        </div>
      </div>
    </div>
    
    <!-- Likes -->
    <div class="metric-card">
      <div class="metric-icon likes-icon">
        <mat-icon>favorite</mat-icon>
      </div>
      <div class="metric-content">
        <div class="metric-value">{{ likesStats.current.toLocaleString() }}</div>
        <div class="metric-label">Likes</div>
        <div class="metric-change" [class.trend-up]="likesStats.trend === 'up'" 
             [class.trend-down]="likesStats.trend === 'down'">
          <mat-icon>{{ likesStats.trend === 'up' ? 'trending_up' : 'trending_down' }}</mat-icon>
          {{ likesStats.change }}%
        </div>
      </div>
    </div>
    
    <!-- Comments -->
    <div class="metric-card">
      <div class="metric-icon comments-icon">
        <img src="assets/images/comment.png" alt="Comments icon" class="metric-img-icon">
      </div>
      <div class="metric-content">
        <div class="metric-value">{{ commentsStats.current.toLocaleString() }}</div>
        <div class="metric-label">Comments</div>
        <div class="metric-change" [class.trend-up]="commentsStats.trend === 'up'" 
             [class.trend-down]="commentsStats.trend === 'down'">
          <mat-icon>{{ commentsStats.trend === 'up' ? 'trending_up' : 'trending_down' }}</mat-icon>
          {{ commentsStats.change }}%
        </div>
      </div>
    </div>
  </div>
  
  <!-- Chart section -->
  <div class="chart-section" *ngIf="!loading">
    <div *ngIf="noDataAvailable && !error" class="no-data-message">
      <mat-icon>info</mat-icon>
      <h3>No data in this period</h3>
      <p>There was no data recorded during the selected time period. Try selecting a different time range.</p>
    </div>
    
    <div *ngIf="!noDataAvailable" class="chart-container">
      <canvas baseChart
              [data]="lineChartData"
              [options]="lineChartOptions"
              [type]="lineChartType"
              width="400"
              height="200">
      </canvas>
    </div>
  </div>
  
  <!-- Additional insights -->
  <div class="insights-section" *ngIf="!noDataAvailable && !loading">
    <div class="insight-card">
      <h4>Most viewed</h4>
      <div class="insight-content">
        <div class="insight-item">
          <span class="insight-label">Home Page</span>
          <span class="insight-value">{{ (viewsStats.current * 0.3).toFixed(0) }} views</span>
        </div>
        <div class="insight-item">
          <span class="insight-label">Blog Posts</span>
          <span class="insight-value">{{ (viewsStats.current * 0.4).toFixed(0) }} views</span>
        </div>
        <div class="insight-item">
          <span class="insight-label">About Page</span>
          <span class="insight-value">{{ (viewsStats.current * 0.2).toFixed(0) }} views</span>
        </div>
      </div>
    </div>
    
    <div class="insight-card">
      <h4>Referrers</h4>
      <div class="insight-content">
        <div class="insight-item">
          <span class="insight-label">Direct</span>
          <span class="insight-value">{{ (visitorsStats.current * 0.4).toFixed(0) }} visitors</span>
        </div>
        <div class="insight-item">
          <span class="insight-label">Google</span>
          <span class="insight-value">{{ (visitorsStats.current * 0.35).toFixed(0) }} visitors</span>
        </div>
        <div class="insight-item">
          <span class="insight-label">Social Media</span>
          <span class="insight-value">{{ (visitorsStats.current * 0.25).toFixed(0) }} visitors</span>
        </div>
      </div>
    </div>
  </div>
</div> 